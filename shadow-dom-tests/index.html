<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thumbnail Pane Shadow DOM Test</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
            background-color: #222;
            color: #eee;
            display: flex;
            height: 100vh;
            overflow: hidden; /* Prevent body scrollbars */
        }
        /* This will be our main content area, pushed by the panel */
        #main-content {
            flex-grow: 1;
            padding: 20px;
            background-color: #333;
            transition: margin-left 0.25s ease; /* Match panel animation */
            height: 100%;
            box-sizing: border-box;
            overflow-y: auto;
        }
        /* Style for when the panel is active */
        body.thumbnail-panel-active #main-content {
            /* Adjusted by JS based on panel width */
        }
        #toggle-panel-btn {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            margin-bottom: 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        #toggle-panel-btn:hover {
            background-color: #45a049;
        }
    </style>
    <script type="module" src="thumbnail-pane.js"></script>
</head>
<body>
    <thumbnail-pane id="my-thumbnail-panel" opened></thumbnail-pane>
    <div id="main-content">
        <button id="toggle-panel-btn">Toggle Panel</button>
        <h1>Main Content Area</h1>
        <p>This area will be pushed when the thumbnail panel is open.</p>
        <p>The thumbnail panel should appear to the left.</p>
    </div>

    <script type="module">
        const panel = document.getElementById('my-thumbnail-panel');
        const mainContent = document.getElementById('main-content');
        const toggleButton = document.getElementById('toggle-panel-btn');

        panel.addEventListener('panel-opened', () => {
            document.body.classList.add('thumbnail-panel-active');
            mainContent.style.marginLeft = panel.getCurrentWidth() + 'px';
            toggleButton.textContent = 'Close Panel';
        });

        panel.addEventListener('panel-closed', () => {
            document.body.classList.remove('thumbnail-panel-active');
            mainContent.style.marginLeft = '0px';
            toggleButton.textContent = 'Open Panel';
        });

        toggleButton.addEventListener('click', () => {
            panel.togglePanel();
        });

        // Initial state sync for the button text if panel is pre-opened
        if (panel.hasAttribute('opened')) {
            // Dispatch an event or call directly if the panel is already open due to the attribute
            // For simplicity, we can assume the panel will fire 'panel-opened' if it starts opened.
            // Or, more robustly:
            if (panel._isPanelActive || panel.classList.contains('active')) { // Check internal state or class
                 document.body.classList.add('thumbnail-panel-active');
                 mainContent.style.marginLeft = panel.getCurrentWidth() + 'px';
                 toggleButton.textContent = 'Close Panel';
            } else {
                 toggleButton.textContent = 'Open Panel';
            }
        } else {
            toggleButton.textContent = 'Open Panel';
        }

        // Listen for paste events on the document
        document.addEventListener('paste', async (event) => {
            console.log('Document paste event detected');
            const items = event.clipboardData?.items;
            if (!items) {
                console.log('No clipboard items found.');
                return;
            }

            const imageFiles = [];
            for (const item of items) {
                if (item.kind === 'file' && item.type.startsWith('image/')) {
                    const file = item.getAsFile();
                    if (file) {
                        console.log('Pasted image file (from document):', file.name, file.type);
                        imageFiles.push(file);
                    }
                }
            }

            if (imageFiles.length > 0) {
                event.preventDefault(); // Prevent default paste action only if we are handling images
                // Call the component's more generic public method
                panel.createNewBatch(imageFiles, { title: "Pasted Images" }); 
                console.log('Called panel.createNewBatch with', imageFiles.length, 'files');
            } else {
                console.log('No image files found in document paste data to forward to panel.');
            }
        });

        // Example: Set some initial data
        panel.setData([
            { 
                id: 'batch1', 
                title: 'Batch 001 - Mixed Files', 
                expanded: true, 
                files: [
                    { name: 'image_landscape.jpg', type: 'image/jpeg' }, 
                    { name: 'document_report.pdf', type: 'application/pdf' }, 
                    { name: 'image_portrait.png', type: 'image/png' },
                    { name: 'important_notes.tiff', type: 'image/tiff' } // Will use SVG placeholder
                ]
            },
            { 
                id: 'batch2', 
                title: 'Batch 002 - More Images', 
                expanded: true, // Let's expand this one too for the demo
                files: [
                    { name: 'photo_A_really_long_name_that_should_be_truncated.png', type: 'image/png' },
                    { name: 'photo_B.gif', type: 'image/gif' },
                    { name: 'photo_C.jpeg', type: 'image/jpeg' }
                ]
            },
            { 
                id: 'batch3', 
                title: 'Batch 003 - Empty', 
                expanded: true, 
                files: []
            },
            { 
                id: 'batch4', 
                title: 'Batch 004 - Collapsed', 
                expanded: false, 
                files: [
                    { name: 'another_image.jpg', type: 'image/jpeg' },
                    { name: 'secret_document.pdf', type: 'application/pdf' }
                ]
            }
        ]);

    </script>
</body>
</html> 